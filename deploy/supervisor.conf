# Supervisor configuration for Trademark Search Web Application
# Place this in /etc/supervisor/conf.d/trademark-search.conf

[program:trademark-search]
command=/opt/trademark-search/venv/bin/gunicorn \
    --workers 4 \
    --worker-class sync \
    --worker-connections 1000 \
    --bind 127.0.0.1:5000 \
    --timeout 300 \
    --keep-alive 2 \
    --max-requests 1000 \
    --max-requests-jitter 50 \
    --preload \
    --access-logfile /var/log/trademark-search/gunicorn-access.log \
    --error-logfile /var/log/trademark-search/gunicorn-error.log \
    --log-level info \
    app:app

# Working directory
directory=/opt/trademark-search

# Run as specific user
user=tmapp
group=tmapp

# Auto start and restart
autostart=true
autorestart=true
startretries=3
startsecs=10

# Process management
numprocs=1
process_name=%(program_name)s

# Logging
stdout_logfile=/var/log/trademark-search/supervisor-stdout.log
stderr_logfile=/var/log/trademark-search/supervisor-stderr.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile_backups=5
stdout_capture_maxbytes=1MB
stderr_capture_maxbytes=1MB

# Environment variables
environment=
    PATH="/opt/trademark-search/venv/bin",
    FLASK_APP="app.py",
    FLASK_ENV="production",
    HEADLESS="true",
    PYTHONPATH="/opt/trademark-search"

# Signal handling
stopwaitsecs=30
killasgroup=true
stopasgroup=true

# Priority (lower values start first)
priority=999